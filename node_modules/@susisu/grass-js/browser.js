// NOTE: hacked together to expose an execute script tag as grass function,
//        returning a promise that resolves with stdout and the return value

const grass = require('./index');

module.exports = (sel, input) => new Promise((resolve, reject) => {
  try {
    const { text } = document.querySelector(sel);
    let stdout = '';
    const vm = new grass.vm.VM(grass.parser.parse(sel, text), input, x => stdout += String.fromCharCode(x));
    vm.run().then(ret => {
      resolve({ stdout, return: ret });
    });
  } catch(e) {
    console.error('err', e);
    reject(`Grass interpretation failed: ${e}`);
  }
});
