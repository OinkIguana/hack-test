// NOTE: hacked together to expose an execute script tag as whitespace function,
//        returning a promise that resolves with stdout and the return value

const ws = require('./index');

module.exports = (sel, input) => new Promise((resolve, reject) => {
  try {
    const { text } = document.querySelector(sel);
    let stdout = '';
    ws.vm.run(ws.parser.ws(sel, text), input, x => stdout += x, () => {}, () => {}).then(ret => {
      resolve({ stdout, return: 0 });
    });
  } catch(e) {
    console.error('err', e);
    reject(`Whitespace interpretation failed: ${e}`);
  }
});
