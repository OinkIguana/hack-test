// NOTE: hacked together to expose an execute script tag as bf function,
//        returning a promise that resolves with stdout and the return value

const bf = require('./index');

module.exports = (sel, input = () => 0) => new Promise((resolve, reject) => {
  try {
    const { text } = document.querySelector(sel);
    let stdout = [];
    const vm = new bf.vm.VM([0, 0, 0, 0, 0, 0], 0, input, x => stdout += String.fromCharCode(x), { autoResizing: true });
    vm.run(bf.parser.parse(sel, text)).then(ret => {
      resolve({ stdout, return: ret });
    });
  } catch(e) {
    console.error('err', e);
    reject(`Grass interpretation failed: ${e}`);
  }
});
